<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ARC Prize Challenge - Interactive Tutorial</title>
  <!-- React and ReactDOM -->
  <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
  <!-- Babel for JSX transpiling -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Material-UI CDN -->
  <script src="https://unpkg.com/@mui/material@5.0.0/umd/material-ui.development.js" crossorigin></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
  <style>
    body { 
      margin: 0; 
      padding: 0; 
      font-family: Roboto, sans-serif; 
      background-color: #121212;
      color: #fff;
    }
    #root { 
      max-width: 1200px; 
      margin: 0 auto; 
      padding: 20px;
    }
    .tutorial-section {
      margin-bottom: 40px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 20px;
      background-color: rgba(255, 255, 255, 0.05);
    }
    .code-block {
      background-color: #1e1e1e;
      padding: 15px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 14px;
      margin: 10px 0;
      overflow-x: auto;
    }
    .color-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin: 10px 0;
    }
    .color-cell {
      width: 24px;
      height: 24px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .section-divider {
      height: 1px;
      background: linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,0.2), rgba(255,255,255,0));
      margin: 30px 0;
    }
    .tab-content {
      padding: 15px 0;
    }
    .url-display {
      background: rgba(0, 0, 0, 0.2);
      padding: 12px;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      word-break: break-all;
      margin: 10px 0;
      display: block;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    // Import Material-UI components
    const { 
      Box, Typography, Button, TextField, Card, CardContent, 
      Tabs, Tab, CircularProgress, Grid, Divider, 
      Chip, Paper, IconButton, Tooltip, LinearProgress,
      alpha, Icon
    } = MaterialUI;

    // Material icon names
    const ICONS = {
      PLAY_ARROW: "play_arrow",
      STOP: "stop",
      REFRESH: "refresh",
      INFO: "info",
      CONTENT_COPY: "content_copy"
    };

    // Sample puzzle data
    const samplePuzzleData = {
      id: "demo_puzzle_001",
      input: [
        [0, 0, 0, 0, 0],
        [0, 1, 1, 1, 0],
        [0, 1, 0, 1, 0],
        [0, 1, 1, 1, 0],
        [0, 0, 0, 0, 0]
      ],
      output: [
        [0, 0, 0, 0, 0],
        [0, 2, 2, 2, 0],
        [0, 2, 0, 2, 0],
        [0, 2, 2, 2, 0],
        [0, 0, 0, 0, 0]
      ]
    };

    // Color map for ARC puzzles
    const colorMap = [
      '#000000', // 0: Black
      '#0074D9', // 1: Blue
      '#FF4136', // 2: Red
      '#2ECC40', // 3: Green
      '#FFDC00', // 4: Yellow
      '#B10DC9', // 5: Purple
      '#FF851B', // 6: Orange
      '#7FDBFF', // 7: Light Blue
      '#F012BE', // 8: Magenta
      '#39CCCC'  // 9: Cyan
    ];

    // ARCPuzzleDisplay component (simplified)
    function ARCPuzzleDisplay({ input, output, prediction }) {
      // Function to render a single grid
      const renderGrid = (grid, title) => {
        if (!grid || !Array.isArray(grid) || grid.length === 0) {
          return (
            <Box>
              <Typography variant="caption" color="text.secondary">
                {title} (No data)
              </Typography>
              <Box sx={{ height: 100, bgcolor: 'rgba(0,0,0,0.2)', borderRadius: 1 }} />
            </Box>
          );
        }
        
        return (
          <Box>
            <Typography variant="caption" color="text.secondary" sx={{ mb: 1, display: 'block' }}>
              {title} ({grid[0].length}Ã—{grid.length})
            </Typography>
            
            <Box 
              sx={{ 
                display: 'inline-block',
                border: '1px solid rgba(255,255,255,0.1)',
                borderRadius: 1,
                overflow: 'hidden'
              }}
            >
              {grid.map((row, rowIndex) => (
                <Box key={rowIndex} sx={{ display: 'flex' }}>
                  {row.map((cell, cellIndex) => (
                    <Box 
                      key={cellIndex}
                      sx={{
                        width: 24,
                        height: 24,
                        bgcolor: colorMap[cell] || '#333',
                        border: '1px solid rgba(0,0,0,0.2)',
                        transition: 'transform 0.2s',
                        '&:hover': {
                          transform: 'scale(1.1)',
                          zIndex: 1
                        }
                      }}
                    />
                  ))}
                </Box>
              ))}
            </Box>
          </Box>
        );
      };
      
      return (
        <Paper sx={{ p: 3, bgcolor: 'rgba(0,0,0,0.2)' }}>
          <Grid container spacing={4}>
            <Grid item xs={12} sm={6} md={4}>
              {renderGrid(input, 'Input')}
            </Grid>
            <Grid item xs={12} sm={6} md={4}>
              {renderGrid(output, 'Expected Output')}
            </Grid>
            {prediction && (
              <Grid item xs={12} sm={6} md={4}>
                {renderGrid(prediction, 'AI Prediction')}
              </Grid>
            )}
          </Grid>
        </Paper>
      );
    }

    // Main tutorial component
    function ARCTutorial() {
      const [tabValue, setTabValue] = React.useState(0);
      const [isProcessing, setIsProcessing] = React.useState(false);
      const [progress, setProgress] = React.useState(0);
      const [logs, setLogs] = React.useState([
        { level: 'info', message: 'System initialized', timestamp: Date.now() }
      ]);
      const [trainingDirectory, setTrainingDirectory] = React.useState('https://github.com/fchollet/ARC/training');
      const [evaluationDirectory, setEvaluationDirectory] = React.useState('https://github.com/fchollet/ARC/evaluation');
      const [prediction, setPrediction] = React.useState(null);
      const [trainingUrl, setTrainingUrl] = React.useState('');
      const [evalUrl, setEvalUrl] = React.useState('');
      const [finalUrl, setFinalUrl] = React.useState('');

      const handleTabChange = (event, newValue) => {
        setTabValue(newValue);
      };

      const addLog = (level, message) => {
        setLogs(prev => [...prev, { level, message, timestamp: Date.now() }]);
      };

      const handleTrainingUrlChange = (event) => {
        const url = event.target.value;
        setTrainingUrl(url);
        addLog('info', `Training URL set to: ${url}`);
        updateFinalUrl(url, evalUrl);
      };

      const handleEvalUrlChange = (event) => {
        const url = event.target.value;
        setEvalUrl(url);
        addLog('info', `Evaluation URL set to: ${url}`);
        updateFinalUrl(trainingUrl, url);
      };

      const updateFinalUrl = (training, eval) => {
        if (training && eval) {
          const finalUrl = `${window.location.origin}/arc-challenge?training=${encodeURIComponent(training)}&evaluation=${encodeURIComponent(eval)}`;
          setFinalUrl(finalUrl);
          addLog('info', `Final URL generated: ${finalUrl}`);
        } else {
          setFinalUrl('');
        }
      };

      const copyFinalUrl = async () => {
        if (finalUrl) {
          try {
            await navigator.clipboard.writeText(finalUrl);
            addLog('info', 'Challenge URL copied to clipboard');
          } catch (err) {
            addLog('error', `Failed to copy URL: ${err.message}`);
          }
        }
      };

      const startProcessing = () => {
        setIsProcessing(true);
        setProgress(0);
        addLog('info', 'Starting processing...');
        
        // Simulate processing with progress updates
        const interval = setInterval(() => {
          setProgress(prev => {
            const newProgress = prev + Math.random() * 5;
            if (newProgress >= 100) {
              clearInterval(interval);
              setIsProcessing(false);
              addLog('info', 'Processing complete');
              
              // Display a simulated prediction after completion
              setPrediction([
                [0, 0, 0, 0, 0],
                [0, 2, 2, 2, 0],
                [0, 2, 0, 2, 0],
                [0, 2, 2, 2, 0],
                [0, 0, 0, 0, 0]
              ]);
              return 100;
            }
            return newProgress;
          });
          
          // Add some sample logs
          if (Math.random() > 0.7) {
            const logTypes = ['info', 'debug', 'warn'];
            const logMessages = [
              'Processing puzzle data',
              'Running agent analysis',
              'Agent combination attempt',
              'Pattern recognition in progress',
              'Evaluating solution confidence'
            ];
            
            addLog(
              logTypes[Math.floor(Math.random() * logTypes.length)],
              logMessages[Math.floor(Math.random() * logMessages.length)]
            );
          }
        }, 500);
      };

      const stopProcessing = () => {
        setIsProcessing(false);
        addLog('warn', 'Processing stopped by user');
      };

      React.useEffect(() => {
        document.getElementById('start-btn').addEventListener('click', () => startProcessing());
        document.getElementById('stop-btn').addEventListener('click', () => stopProcessing());
        
        // Add URL input listeners
        document.getElementById('training-dir').addEventListener('change', handleTrainingUrlChange);
        document.getElementById('eval-dir').addEventListener('change', handleEvalUrlChange);
      }, []);

      return (
        <Box>
          <Typography variant="h4" gutterBottom>
            ARC Prize Challenge
          </Typography>

          <Tabs value={tabValue} onChange={handleTabChange}>
            <Tab label="Instructions" />
            <Tab label="Demo" />
            <Tab label="Logs" />
          </Tabs>

          <Box className="tab-content">
            {tabValue === 0 && (
              <Box>
                <Typography variant="h6" gutterBottom>
                  Getting Started
                </Typography>
                <Typography paragraph>
                  Welcome to the ARC Prize Challenge! This interactive demo will help you understand how to participate in the challenge.
                </Typography>

                <Typography variant="h6" gutterBottom>
                  Step 1: Set Up Your Environment
                </Typography>
                <Typography paragraph>
                  First, you'll need to provide the URLs for your training and evaluation directories:
                </Typography>

                <Box sx={{ mb: 3 }}>
                  <TextField
                    fullWidth
                    label="Training Directory URL"
                    value={trainingUrl}
                    onChange={handleTrainingUrlChange}
                    sx={{ mb: 2 }}
                  />
                  <TextField
                    fullWidth
                    label="Evaluation Directory URL"
                    value={evalUrl}
                    onChange={handleEvalUrlChange}
                    sx={{ mb: 2 }}
                  />
                </Box>

                {finalUrl && (
                  <Paper sx={{ p: 2, mb: 3, bgcolor: 'rgba(0,0,0,0.2)' }}>
                    <Typography variant="subtitle1" gutterBottom>
                      Your Challenge URL:
                    </Typography>
                    <code className="url-display">
                      {finalUrl}
                    </code>
                    <Button
                      variant="contained"
                      onClick={copyFinalUrl}
                      startIcon={<Icon>content_copy</Icon>}
                      sx={{ mt: 1 }}
                    >
                      Copy URL
                    </Button>
                  </Paper>
                )}

                <Typography variant="h6" gutterBottom>
                  Step 2: Process Your Data
                </Typography>
                <Typography paragraph>
                  Once you've set up your environment, you can start processing your data.
                </Typography>
              </Box>
            )}
            
            {tabValue === 1 && (
              <div className="tab-content">
                <div className="tutorial-section">
                  <Typography variant="h5" gutterBottom>
                    Try the ARC Prize Challenge
                  </Typography>
                  
                  <Box display="flex" justifyContent="space-between" alignItems="center" mb={4}>
                    <Box>
                      <Typography variant="subtitle1" color="text.secondary">
                        Configure and run ARC puzzle processing
                      </Typography>
                    </Box>
                    <Box display="flex" gap={2}>
                      <Tooltip title="Refresh data">
                        <IconButton>
                          <Icon>refresh</Icon>
                        </IconButton>
                      </Tooltip>
                      <Button
                        variant="contained"
                        onClick={startProcessing}
                        disabled={isProcessing}
                        startIcon={<Icon>play_arrow</Icon>}
                        sx={{
                          background: `linear-gradient(135deg, #0074D9 0%, #0063B1 100%)`,
                          '&:hover': {
                            background: `linear-gradient(135deg, #0063B1 0%, #0074D9 100%)`,
                          },
                        }}
                      >
                        Start Processing
                      </Button>
                    </Box>
                  </Box>

                  <Grid container spacing={3} mb={4}>
                    <Grid item xs={12} md={6}>
                      <Card sx={{ bgcolor: 'rgba(0,0,0,0.2)' }}>
                        <CardContent>
                          <Typography variant="h6" gutterBottom>
                            Training Phase
                          </Typography>
                          <Divider sx={{ mb: 2 }} />
                          <TextField
                            label="Training Directory URL"
                            fullWidth
                            margin="normal"
                            value={trainingDirectory}
                            onChange={(e) => setTrainingDirectory(e.target.value)}
                            disabled={isProcessing}
                            sx={{ mb: 2 }}
                            InputProps={{
                              sx: { color: '#fff' }
                            }}
                          />
                        </CardContent>
                      </Card>
                    </Grid>
                    <Grid item xs={12} md={6}>
                      <Card sx={{ bgcolor: 'rgba(0,0,0,0.2)' }}>
                        <CardContent>
                          <Typography variant="h6" gutterBottom>
                            Evaluation Phase
                          </Typography>
                          <Divider sx={{ mb: 2 }} />
                          <TextField
                            label="Evaluation Directory URL"
                            fullWidth
                            margin="normal"
                            value={evaluationDirectory}
                            onChange={(e) => setEvaluationDirectory(e.target.value)}
                            disabled={isProcessing}
                            sx={{ mb: 2 }}
                            InputProps={{
                              sx: { color: '#fff' }
                            }}
                          />
                        </CardContent>
                      </Card>
                    </Grid>
                  </Grid>

                  <div class="phase-card final-url-card" style="display: none;">
                    <h2>Challenge URL</h2>
                    <div class="input-group">
                      <p>Your configured challenge URL:</p>
                      <code id="final-url-display" class="url-display"></code>
                      <div class="tip">
                        <strong>Note:</strong> This URL combines your training and evaluation directories.
                        Save it to resume your challenge or share with others.
                      </div>
                    </div>
                  </div>

                  <div class="controls">
                    <button id="start-btn" class="btn primary">Start Processing</button>
                    <button id="stop-btn" class="btn danger" disabled>Stop Processing</button>
                    <button id="copy-url-btn" class="btn secondary" style="display: none;">Copy URL</button>
                  </div>

                  {isProcessing && (
                    <Box mb={3}>
                      <Box display="flex" alignItems="center" mb={1}>
                        <Typography variant="body1" sx={{ mr: 2 }}>
                          Processing: Training Phase
                        </Typography>
                        <Typography variant="body2" color="text.secondary">
                          {Math.round(progress)}% complete
                        </Typography>
                      </Box>
                      <LinearProgress 
                        variant="determinate" 
                        value={progress} 
                        sx={{ 
                          height: 8, 
                          borderRadius: 4,
                          bgcolor: 'rgba(0,0,0,0.2)',
                        }}
                      />
                      <Box display="flex" justifyContent="center" mt={2}>
                        <Button
                          variant="contained"
                          color="error"
                          onClick={stopProcessing}
                          startIcon={<Icon>stop</Icon>}
                        >
                          Stop Processing
                        </Button>
                      </Box>
                    </Box>
                  )}

                  <Typography variant="h6" gutterBottom sx={{ mt: 4 }}>
                    Current Puzzle
                  </Typography>
                  <ARCPuzzleDisplay 
                    input={samplePuzzleData.input} 
                    output={samplePuzzleData.output}
                    prediction={prediction}
                  />
                  
                  <Typography variant="h6" gutterBottom sx={{ mt: 4 }}>
                    Processing Logs
                  </Typography>
                  <Paper
                    sx={{
                      maxHeight: '200px',
                      overflow: 'auto',
                      p: 2,
                      bgcolor: 'rgba(0,0,0,0.3)',
                    }}
                  >
                    {logs.map((log, index) => (
                      <Box 
                        key={index} 
                        mb={1} 
                        sx={{ 
                          color: log.level === 'error' 
                            ? '#FF4136' 
                            : log.level === 'warn' 
                              ? '#FF851B' 
                              : log.level === 'debug'
                                ? '#7FDBFF'
                                : '#fff'
                        }}
                      >
                        <Typography variant="body2" fontFamily="monospace">
                          [{new Date(log.timestamp).toLocaleTimeString()}] {log.message}
                        </Typography>
                      </Box>
                    ))}
                  </Paper>
                </div>
              </div>
            )}
            
            {tabValue === 2 && (
              <div className="tab-content">
                <div className="tutorial-section">
                  <Typography variant="h5" gutterBottom>Key Code Examples</Typography>
                  
                  <Typography variant="h6" sx={{ mt: 3, mb: 1 }}>ARCPuzzleDisplay Component:</Typography>
                  <div className="code-block">
                    {`import React from 'react';
import { Box, Paper, Typography, Grid } from '@mui/material';

const ARCPuzzleDisplay = ({ input, output, prediction }) => {
  // Color palette for grid cells
  const colorMap = [
    '#000000', '#0074D9', '#FF4136', '#2ECC40', '#FFDC00', 
    '#B10DC9', '#FF851B', '#7FDBFF', '#F012BE', '#39CCCC'
  ];
  
  // Function to render a single grid
  const renderGrid = (grid, title) => {
    return (
      <Box>
        <Typography variant="caption">{title}</Typography>
        <Box sx={{ display: 'inline-block', borderRadius: 1 }}>
          {grid.map((row, rowIndex) => (
            <Box key={rowIndex} sx={{ display: 'flex' }}>
              {row.map((cell, cellIndex) => (
                <Box 
                  key={cellIndex}
                  sx={{
                    width: 24,
                    height: 24,
                    bgcolor: colorMap[cell],
                    border: '1px solid rgba(0,0,0,0.2)'
                  }}
                />
              ))}
            </Box>
          ))}
        </Box>
      </Box>
    );
  };
  
  return (
    <Paper sx={{ p: 3 }}>
      <Grid container spacing={4}>
        <Grid item xs={12} sm={6} md={4}>
          {renderGrid(input, 'Input')}
        </Grid>
        <Grid item xs={12} sm={6} md={4}>
          {renderGrid(output, 'Expected Output')}
        </Grid>
        {prediction && (
          <Grid item xs={12} sm={6} md={4}>
            {renderGrid(prediction, 'AI Prediction')}
          </Grid>
        )}
      </Grid>
    </Paper>
  );
};

export default ARCPuzzleDisplay;`}
                  </div>
                  
                  <Typography variant="h6" sx={{ mt: 4, mb: 1 }}>Agent Performance Tracking:</Typography>
                  <div className="code-block">
                    {`// Agent performance tracking
const AgentPerformanceTracker = {
  singleAgents: new Map(),
  combinations: new Map(),
  
  trackSingleAgent: function(agentName, success, puzzleId, confidence) {
    if (!this.singleAgents.has(agentName)) {
      this.singleAgents.set(agentName, {
        successes: 0,
        attempts: 0,
        successRate: 0,
        avgConfidence: 0
      });
    }
    
    const stats = this.singleAgents.get(agentName);
    stats.attempts++;
    
    if (success) {
      stats.successes++;
    }
    
    stats.successRate = (stats.successes / stats.attempts) * 100;
    stats.avgConfidence = ((stats.avgConfidence * (stats.attempts - 1)) + confidence) / stats.attempts;
  },
  
  recommendCombinations: function(puzzleId, maxAgents = 3) {
    // Logic to recommend optimal agent combinations based on past performance
    // ...
    return recommendations;
  }
};`}
                  </div>
                  
                  <Typography variant="h6" sx={{ mt: 4, mb: 1 }}>Processing Puzzles with Agents:</Typography>
                  <div className="code-block">
                    {`const processPuzzleWithAgents = async (puzzleData, phase) => {
  try {
    // 1. Load agent definitions
    const agents = await loadAgentDefinitions();
    
    // 2. Create a list of promises for each agent to process the puzzle
    const agentPromises = agents.map(agent => {
      return withRetry(async () => {
        const result = await axios.post('/api/arc/process', {
          puzzle: puzzleData,
          agent: agent.name,
          phase: phase,
          agent_code: agent.agent_code
        });
        
        // Track single agent performance
        const success = isCorrectSolution(result.data.candidate, puzzleData.output);
        AgentPerformanceTracker.trackSingleAgent(
          agent.name,
          success,
          puzzleData.id,
          result.data.metadata.confidence
        );
        
        return result;
      });
    });

    // 3. Run all agents in parallel
    const results = await Promise.allSettled(agentPromises);
    
    // 4. Check for successful solutions and process agent combinations
    // ...

    return {
      success: true,
      prediction: bestResult.data.candidate,
      agent: bestResult.data.metadata.method,
      confidence: bestResult.data.metadata.confidence
    };
  } catch (err) {
    log(LogLevel.ERROR, 'Failed to process puzzle with agents', err);
    throw err;
  }
};`}
                  </div>
                </div>
              </div>
            )}
          </Box>
        </Box>
      );
    }

    ReactDOM.render(<ARCTutorial />, document.getElementById('root'));
  </script>
</body>
</html> 