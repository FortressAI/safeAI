<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agent Browser - Interactive Demo</title>
  <!-- React and ReactDOM -->
  <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
  <!-- Babel for JSX transpiling -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Material-UI CDN -->
  <script src="https://unpkg.com/@mui/material@5.0.0/umd/material-ui.development.js" crossorigin></script>
  <!-- D3.js for visualizations -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <!-- Plotly for resource charts -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <!-- Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,400,500,700&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" />
  <!-- Shared styles -->
  <link rel="stylesheet" href="../css/shared-demo.css" />
  <style>
    .agent-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .agent-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 20px;
      position: relative;
      overflow: hidden;
      transition: transform 0.2s;
    }
    
    .agent-card:hover {
      transform: translateY(-5px);
    }
    
    .agent-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
    }
    
    .agent-metrics {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 15px;
    }
    
    .metric-item {
      text-align: center;
      padding: 10px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 4px;
    }
    
    .metric-value {
      font-size: 20px;
      font-weight: bold;
      color: var(--primary-color);
    }
    
    .metric-label {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.7);
    }
    
    .search-bar {
      margin-bottom: 20px;
      width: 100%;
      padding: 12px;
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      color: white;
    }
    
    .filter-chips {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .filter-chip {
      padding: 6px 12px;
      border-radius: 16px;
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.1);
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .filter-chip.active {
      background: var(--primary-color);
      border-color: var(--primary-color);
    }
    
    .resource-chart {
      height: 200px;
      margin-top: 20px;
    }
    
    .analytics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .analytics-card {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      padding: 20px;
    }
    
    .status-indicator {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 8px;
    }
    
    .status-active { background-color: #4CAF50; }
    .status-inactive { background-color: #F44336; }
    .status-maintenance { background-color: #FFC107; }

    .instructions-section {
      background: linear-gradient(135deg, rgba(33, 150, 243, 0.1) 0%, rgba(33, 150, 243, 0.05) 100%);
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 30px;
      border: 1px solid rgba(33, 150, 243, 0.2);
    }

    .instructions-section h2 {
      color: #2196f3;
      margin-top: 0;
    }

    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }

    .feature-box {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      padding: 15px;
    }

    .feature-box h4 {
      color: #2196f3;
      margin: 0 0 10px 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .feature-box h4 i {
      font-size: 20px;
    }

    .metric-example {
      display: inline-block;
      background: rgba(76, 175, 80, 0.1);
      color: #4CAF50;
      padding: 2px 8px;
      border-radius: 4px;
      font-family: 'Fira Code', monospace;
      margin: 2px;
    }

    .tip {
      background: rgba(255, 193, 7, 0.1);
      border-left: 4px solid #FFC107;
      padding: 10px 15px;
      margin: 10px 0;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { 
      Box, Typography, Button, Card, CardContent, 
      Tabs, Tab, Grid, Divider, 
      Avatar, Chip, Paper, IconButton, Tooltip, LinearProgress,
      TextField, Dialog, DialogTitle, DialogContent, DialogActions,
      List, ListItem, ListItemText, ListItemIcon, 
      CircularProgress, Alert
    } = MaterialUI;

    // Enhanced agents data with more realistic metrics
    const agents = [
      { 
        id: 1,
        name: 'Math Solver',
        type: 'Specialized', 
        domain: 'Mathematics',
        version: '2.1.0',
        status: 'Active',
        description: 'An agent specialized in solving complex mathematical problems',
        capabilities: ['Theorem proving', 'Equation solving', 'Optimization'],
        metrics: {
          tasksCompleted: 1247,
          successRate: 98.5,
          avgResponseTime: 0.8,
          uptime: 99.9
        },
        lastActive: '2 minutes ago',
        resourceUsage: {
          cpu: 45,
          memory: 60,
          network: 30
        }
      },
      { 
        id: 2,
        name: 'Ethics Analyzer',
        type: 'Knowledge-based', 
        domain: 'Ethics',
        version: '1.5.2',
        status: 'Active',
        description: 'Analyzes ethical implications of decisions and scenarios',
        capabilities: ['Value alignment', 'Ethical analysis', 'Cultural sensitivity'],
        metrics: {
          tasksCompleted: 856,
          successRate: 95.2,
          avgResponseTime: 1.2,
          uptime: 99.8
        },
        lastActive: '5 minutes ago',
        resourceUsage: {
          cpu: 35,
          memory: 45,
          network: 25
        }
      },
      { 
        id: 3,
        name: 'Security Monitor',
        type: 'System', 
        domain: 'Security',
        version: '3.0.1',
        status: 'Active',
        description: 'Monitors system security and detects potential threats',
        capabilities: ['Threat detection', 'Vulnerability scanning', 'Access control'],
        metrics: {
          tasksCompleted: 2341,
          successRate: 99.9,
          avgResponseTime: 0.3,
          uptime: 100
        },
        lastActive: 'Just now',
        resourceUsage: {
          cpu: 55,
          memory: 70,
          network: 40
        }
      }
    ];

    function Instructions() {
      return (
        <div className="instructions-section">
          <h2>Welcome to the Agent Browser</h2>
          <p>
            Explore and monitor AI agents in the SafeAI ecosystem. This interactive browser allows you to view agent details,
            track performance metrics, and analyze resource usage in real-time.
          </p>

          <div className="features-grid">
            <div className="feature-box">
              <h4><i className="material-icons">search</i>Search & Filter</h4>
              <ul>
                <li>Use the search bar to find agents by name or capability</li>
                <li>Filter agents by domain using the category chips</li>
                <li>View active, inactive, and maintenance status</li>
              </ul>
            </div>

            <div className="feature-box">
              <h4><i className="material-icons">analytics</i>Performance Metrics</h4>
              <ul>
                <li>Tasks completed: <span className="metric-example">1,247</span></li>
                <li>Success rate: <span className="metric-example">98.5%</span></li>
                <li>Response time: <span className="metric-example">0.8s</span></li>
                <li>Uptime: <span className="metric-example">99.9%</span></li>
              </ul>
            </div>

            <div className="feature-box">
              <h4><i className="material-icons">memory</i>Resource Monitoring</h4>
              <ul>
                <li>Real-time CPU usage tracking</li>
                <li>Memory consumption analysis</li>
                <li>Network bandwidth monitoring</li>
                <li>Historical performance data</li>
              </ul>
            </div>

            <div className="feature-box">
              <h4><i className="material-icons">settings</i>Agent Management</h4>
              <ul>
                <li>View detailed agent capabilities</li>
                <li>Check version information</li>
                <li>Monitor agent status</li>
                <li>Access activity logs</li>
              </ul>
            </div>
          </div>

          <div className="tip">
            <strong>Pro Tip:</strong> Click on any agent card to view detailed metrics, resource usage graphs,
            and historical performance data. Use the search bar to quickly find agents by their capabilities.
          </div>
        </div>
      );
    }

    // Custom hooks for agent management
    function useAgentManagement() {
      const [agents, setAgents] = React.useState(agents);
      const [selectedAgent, setSelectedAgent] = React.useState(null);
      const [isLoading, setIsLoading] = React.useState(false);
      const [error, setError] = React.useState(null);

      const updateAgentStatus = React.useCallback(async (agentId, newStatus) => {
        setIsLoading(true);
        setError(null);
        try {
          // Simulate API call
          await new Promise(resolve => setTimeout(resolve, 500));
          setAgents(prev => prev.map(agent => 
            agent.id === agentId ? { ...agent, status: newStatus } : agent
          ));
        } catch (err) {
          setError('Failed to update agent status');
        } finally {
          setIsLoading(false);
        }
      }, []);

      const updateAgentMetrics = React.useCallback(async (agentId, metrics) => {
        setIsLoading(true);
        setError(null);
        try {
          // Simulate API call
          await new Promise(resolve => setTimeout(resolve, 500));
          setAgents(prev => prev.map(agent => 
            agent.id === agentId ? { ...agent, metrics } : agent
          ));
        } catch (err) {
          setError('Failed to update agent metrics');
        } finally {
          setIsLoading(false);
        }
      }, []);

      return {
        agents,
        selectedAgent,
        setSelectedAgent,
        isLoading,
        error,
        updateAgentStatus,
        updateAgentMetrics
      };
    }

    // Custom hook for filtering and searching
    function useAgentFilters() {
      const [searchQuery, setSearchQuery] = React.useState('');
      const [activeFilters, setActiveFilters] = React.useState({
        type: [],
        domain: [],
        status: []
      });

      const filterAgents = React.useCallback((agents) => {
        return agents.filter(agent => {
          const matchesSearch = agent.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                              agent.description.toLowerCase().includes(searchQuery.toLowerCase());
          
          const matchesType = activeFilters.type.length === 0 || activeFilters.type.includes(agent.type);
          const matchesDomain = activeFilters.domain.length === 0 || activeFilters.domain.includes(agent.domain);
          const matchesStatus = activeFilters.status.length === 0 || activeFilters.status.includes(agent.status);
          
          return matchesSearch && matchesType && matchesDomain && matchesStatus;
        });
      }, [searchQuery, activeFilters]);

      const toggleFilter = React.useCallback((category, value) => {
        setActiveFilters(prev => ({
          ...prev,
          [category]: prev[category].includes(value)
            ? prev[category].filter(v => v !== value)
            : [...prev[category], value]
        }));
      }, []);

      return {
        searchQuery,
        setSearchQuery,
        activeFilters,
        toggleFilter,
        filterAgents
      };
    }

    // Agent Card Component with memoization
    const AgentCard = React.memo(function AgentCard({ agent, onSelect, onStatusChange }) {
      const handleStatusChange = React.useCallback(() => {
        const newStatus = agent.status === 'Active' ? 'Inactive' : 'Active';
        onStatusChange(agent.id, newStatus);
      }, [agent.id, agent.status, onStatusChange]);

      return (
        <Card className="agent-card">
          <CardContent>
            <Box sx={{ display: 'flex', alignItems: 'center', mb: 2 }}>
              <Avatar sx={{ bgcolor: 'primary.main', mr: 2 }}>
                {agent.name.charAt(0)}
              </Avatar>
              <Box sx={{ flex: 1 }}>
                <Typography variant="h6">{agent.name}</Typography>
                <Typography variant="body2" color="text.secondary">
                  {agent.type} â€¢ {agent.domain}
                </Typography>
              </Box>
              <IconButton onClick={handleStatusChange}>
                <Icon>{agent.status === 'Active' ? 'check_circle' : 'cancel'}</Icon>
              </IconButton>
            </Box>
            
            <Typography variant="body2" paragraph>
              {agent.description}
            </Typography>
            
            <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 1, mb: 2 }}>
              {agent.capabilities.map(capability => (
                <Chip key={capability} label={capability} size="small" />
              ))}
            </Box>
            
            <Grid container spacing={2}>
              {Object.entries(agent.metrics).map(([key, value]) => (
                <Grid item xs={6} key={key}>
                  <Paper className="metric-item">
                    <Typography variant="h6" className="metric-value">
                      {value}
                    </Typography>
                    <Typography variant="caption" className="metric-label">
                      {key.replace(/([A-Z])/g, ' $1').trim()}
                    </Typography>
                  </Paper>
                </Grid>
              ))}
            </Grid>
          </CardContent>
        </Card>
      );
    });

    // Agent Details Dialog Component
    const AgentDetailsDialog = React.memo(function AgentDetailsDialog({ 
      agent, 
      open, 
      onClose,
      onMetricsUpdate 
    }) {
      const [metrics, setMetrics] = React.useState(agent.metrics);

      const handleMetricsUpdate = React.useCallback(() => {
        onMetricsUpdate(agent.id, metrics);
      }, [agent.id, metrics, onMetricsUpdate]);

      return (
        <Dialog open={open} onClose={onClose} maxWidth="md" fullWidth>
          <DialogTitle>
            <Box sx={{ display: 'flex', alignItems: 'center' }}>
              <Avatar sx={{ bgcolor: 'primary.main', mr: 2 }}>
                {agent.name.charAt(0)}
              </Avatar>
              {agent.name}
            </Box>
          </DialogTitle>
          <DialogContent>
            <Grid container spacing={3}>
              <Grid item xs={12} md={6}>
                <Typography variant="h6" gutterBottom>
                  Details
                </Typography>
                <List>
                  <ListItem>
                    <ListItemIcon><Icon>category</Icon></ListItemIcon>
                    <ListItemText primary="Type" secondary={agent.type} />
                  </ListItem>
                  <ListItem>
                    <ListItemIcon><Icon>domain</Icon></ListItemIcon>
                    <ListItemText primary="Domain" secondary={agent.domain} />
                  </ListItem>
                  <ListItem>
                    <ListItemIcon><Icon>info</Icon></ListItemIcon>
                    <ListItemText primary="Version" secondary={agent.version} />
                  </ListItem>
                  <ListItem>
                    <ListItemIcon><Icon>schedule</Icon></ListItemIcon>
                    <ListItemText primary="Last Active" secondary={agent.lastActive} />
                  </ListItem>
                </List>
              </Grid>
              <Grid item xs={12} md={6}>
                <Typography variant="h6" gutterBottom>
                  Metrics
                </Typography>
                {Object.entries(metrics).map(([key, value]) => (
                  <Box key={key} sx={{ mb: 2 }}>
                    <Typography variant="body2" color="text.secondary">
                      {key.replace(/([A-Z])/g, ' $1').trim()}
                    </Typography>
                    <TextField
                      type="number"
                      value={value}
                      onChange={(e) => setMetrics(prev => ({
                        ...prev,
                        [key]: parseFloat(e.target.value)
                      }))}
                      size="small"
                      fullWidth
                    />
                  </Box>
                ))}
              </Grid>
            </Grid>
          </DialogContent>
          <DialogActions>
            <Button onClick={onClose}>Close</Button>
            <Button onClick={handleMetricsUpdate} variant="contained">
              Update Metrics
            </Button>
          </DialogActions>
        </Dialog>
      );
    });

    // Main Agent Browser Component
    function AgentBrowser() {
      const {
        agents,
        selectedAgent,
        setSelectedAgent,
        isLoading,
        error,
        updateAgentStatus,
        updateAgentMetrics
      } = useAgentManagement();

      const {
        searchQuery,
        setSearchQuery,
        activeFilters,
        toggleFilter,
        filterAgents
      } = useAgentFilters();

      const filteredAgents = React.useMemo(() => 
        filterAgents(agents),
        [agents, filterAgents]
      );

      return (
        <Box sx={{ p: 3 }}>
          <Typography variant="h4" gutterBottom>
            Agent Browser
          </Typography>
          <Typography variant="subtitle1" color="text.secondary" paragraph>
            Monitor and manage SafeAI agents
          </Typography>

          {error && (
            <Alert severity="error" sx={{ mb: 2 }}>
              {error}
            </Alert>
          )}

          <Paper sx={{ p: 2, mb: 3 }}>
            <TextField
              fullWidth
              variant="outlined"
              placeholder="Search agents..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              InputProps={{
                startAdornment: <Icon sx={{ mr: 1 }}>search</Icon>
              }}
            />
          </Paper>

          <Box sx={{ mb: 3 }}>
            <Typography variant="subtitle2" gutterBottom>
              Filters
            </Typography>
            <Box sx={{ display: 'flex', gap: 1, flexWrap: 'wrap' }}>
              {['Type', 'Domain', 'Status'].map(category => (
                <React.Fragment key={category}>
                  {Array.from(new Set(agents.map(a => a[category.toLowerCase()]))).map(value => (
                    <Chip
                      key={value}
                      label={value}
                      onClick={() => toggleFilter(category.toLowerCase(), value)}
                      color={activeFilters[category.toLowerCase()].includes(value) ? 'primary' : 'default'}
                    />
                  ))}
                </React.Fragment>
              ))}
            </Box>
          </Box>

          {isLoading ? (
            <Box sx={{ display: 'flex', justifyContent: 'center', p: 3 }}>
              <CircularProgress />
            </Box>
          ) : (
            <Grid container spacing={3}>
              {filteredAgents.map(agent => (
                <Grid item xs={12} sm={6} md={4} key={agent.id}>
                  <AgentCard
                    agent={agent}
                    onSelect={() => setSelectedAgent(agent)}
                    onStatusChange={updateAgentStatus}
                  />
                </Grid>
              ))}
            </Grid>
          )}

          {selectedAgent && (
            <AgentDetailsDialog
              agent={selectedAgent}
              open={!!selectedAgent}
              onClose={() => setSelectedAgent(null)}
              onMetricsUpdate={updateAgentMetrics}
            />
          )}
        </Box>
      );
    }

    // Render the app
    ReactDOM.render(<AgentBrowser />, document.getElementById('root'));
  </script>
</body>
</html> 